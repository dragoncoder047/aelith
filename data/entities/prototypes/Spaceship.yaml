tags: [spaceship]
physics:
  - [rect, -65, -37, 131, 74]
  - [noColl, explorer]
navHeight: { x: 1, y: 1 }
behavior:
  canBePlayer: yes
  camScale: 0.8
  moveSpeed: 1000
  inventorySlots: 20
  inventorySize: null
  inventoryHolder: inventory
model:
  skeleton:
    - name: gazeTarget
    - name: body
      render:
        as: sprite
        sprite: spaceship
        anchor: center
        frame: 2
        flip: [true, false]
        z: 0
      children:
        - name: tentacleRot
          render:
            angle: 180
        - name: backdoor
          render:
            as: sprite
            sprite: spaceship
            anchor: center
            frame: 0
            flip: [true, false]
            z: -1
        - name: interior
          render:
            as: sprite
            sprite: spaceship
            anchor: center
            flip: [true, false]
            frame: 1
            z: -1
        - name: frontdoor
          render:
            as: sprite
            sprite: spaceship
            anchor: center
            flip: [true, false]
            frame: 0
            z: 0
    - name: invMask
      render:
        as: sprite
        sprite: spaceship
        anchor: center
        frame: 0
        z: -1
        mask: "&"
      children:
        - name: inventory
          pos: { x: &invPosX 10, y: &invPosY 20 }
    - name: light
      render:
        as: light
        type: point
        color: "#ddddff"
        intensity: 2
        near: 100
        far: 200
  tentacles:
    - &st
      name: ta
      bone: body
      render:
        color: xt250
        cap: round
        z: -2
      pos: { x: -40, y: 20 }
      n: 8
      lps: 6
      sizes: [12, 1]
      masses: [1, 1]
      gravityIsLocal: yes
      eachConstraint: [angle, tentacleRot, 1, -90]
    - <<: *st
      name: tb
      pos: { x: -40, y: -30 }
  kinematics:
    look:
      origin: body
      target: gazeTarget
    initial: flying
    states:
      flying:
        gravityScale: 0
        bones:
          - bone: body
            flip: [true, false]
  anims:
    doorOpen:
      cancel: [doorClose]
      channels:
        - target: [frontdoor, pos]
          keyframes:
            - [&doorTime 1, { x: 0, y: 0 }]
            - [0, { x: 0, y: &doorMotion -64 }]
        - target: [frontdoor, angle]
          keyframes:
            - [*doorTime, 0]
            - [0, &doorTilt 30]
    doorClose:
      cancel: [doorOpen]
      channels:
        - target: [frontdoor, pos]
          keyframes:
            - [*doorTime, { x: 0, y: *doorMotion }]
            - [0, { x: 0, y: 0 }]
        - target: [frontdoor, angle]
          keyframes:
            - [*doorTime, *doorTilt]
            - [0, 0]
hooks:
  setup:
    - do
    - [be, doorOpen, false]
  load:
    - do
    - [hold, test]
  render:
    # Why is all of this necessary.
    - do
    - [
        boneSet,
        [list, invMask, flipX],
        [==, [boneGet, [list, body, scale, x]], 1],
      ]
    - [
        boneSet,
        [list, inventory, pos],
        [vec2, ["*", [boneGet, [list, body, scale, x]], *invPosX], *invPosY],
      ]
  stateChanged:
    - switch
    - [the, slot]
    - doorOpen:
        [
          unless,
          [isVoid, [the, oldValue]],
          [anim, [if, [the, value], doorOpen, doorClose]],
        ]
  action1: [be, doorOpen, [not, [my, doorOpen]]]
