tags: [explorer]
physics:
  - - poly
    - { x: 0, y: -31.5 }
    - { x: 16, y: -16 }
    - { x: 16, y: 16 }
    - { x: .1, y: 31.5 }
    - { x: -0.1, y: 31.5 }
    - { x: -16, y: 16 }
    - { x: -16, y: -16 }
navHeight: { x: 1, y: 0 }
behavior:
  canBePlayer: yes
  canFly: no
  moveSpeed: 125
  sprintSpeed: 200
  jumpForce: 250
  inventorySlots: 8
  inventorySize: null
model:
  speechBubble:
    origin: speechBubbleOrigin
  skeleton:
    - name: speechBubbleOrigin
      pos: { x: 0, y: -36 }
      render:
        layer: speechBubble
    - name: gazeTarget
      pos: { x: 100, y: -25 }
    - name: leftFootTarget
      pos: { x: -8, y: 29 }
    - name: rightFootTarget
      pos: { x: 8, y: 29 }
    - name: leftHandTarget
      pos: { x: -11, y: 8 }
    - name: rightHandTarget
      pos: { x: 11, y: 8 }
    - name: body
      render:
        as: sprite
        sprite: explorerBody
        anchor: center
      pos: { x: 0, y: 0 }
      children:
        - name: neck
          pos: { x: 0, y: -25 }
          ik:
            angleRange: [-100, 100]
          children:
            - name: head
              render:
                as: sprite
                sprite: explorerHead
                anchor: center
                angle: 90
              ik:
                naturalDirection: { x: 0, y: -1 }
              children:
                - name: rightEyeSocket
                  pos: { x: -3, y: -2.4 }
                  children:
                    - name: rightEye
                      pos: { x: -1, y: 0 }
                      render: &eye
                        as: rect
                        anchor: left
                        size: [1, 1]
                        scale: { x: 1, y: 3 }
                        color: white
                      ik:
                        target: [gazeTarget, 1]
                      constraint: [angle, neck, 0, 0]
                - name: leftEyeSocket
                  pos: { x: 1, y: -2.4 }
                  children:
                    - name: leftEye
                      pos: { x: -1, y: 0 }
                      render: *eye
                      ik:
                        target: [gazeTarget, 1]
                      constraint: [angle, neck, 0, 0]
            - name: gazeSource
              pos: { x: 0, y: -10 }
              ik:
                target: [gazeTarget, 1]
        - name: leftUpperLeg
          pos: { x: -5, y: 13 }
          render:
            as: polyline
            pts: [{ x: 0, y: 0 }, { x: 0, y: 9 }]
            angle: 12
            color: white
            join: round
            cap: round
            width: 4
          ik:
            angleRange: [-90, 30]
          children:
            - name: leftLowerLeg
              render:
                as: polyline
                pts: [{ x: 0, y: 0 }, { x: 0, y: 9 }]
                angle: 12
                color: white
                join: round
                cap: round
                width: 4
              pos: { x: 0, y: 9 }
              ik:
                angleRange: [-10, 135]
              children:
                - pos: { x: 0, y: 9 }
                  children:
                    - name: leftFoot
                      render: &foot
                        as: sprite
                        sprite: explorerFoot
                        anchor: { x: -0.5, y: -1 }
                      constraint: [angle, body, 0, 0]
                  ik:
                    target: [leftFootTarget, 2]
        - name: rightUpperLeg
          pos: { x: 5, y: 13 }
          render:
            as: polyline
            pts: [{ x: 0, y: 0 }, { x: 0, y: 9 }]
            angle: 12
            color: white
            join: round
            cap: round
            width: 4
          ik:
            angleRange: [-90, 30]
          children:
            - name: rightLowerLeg
              render:
                as: polyline
                pts: [{ x: 0, y: 0 }, { x: 0, y: 9 }]
                angle: 12
                color: white
                join: round
                cap: round
                width: 4
              pos: { x: 0, y: 9 }
              ik:
                angleRange: [-10, 135]
              children:
                - pos: { x: 0, y: 9 }
                  children:
                    - name: rightFoot
                      render: *foot
                      constraint: [angle, body, 0, 0]
                  ik:
                    target: [rightFootTarget, 2]
        - name: leftUpperArm
          pos: { x: -6, y: -12 }
          render:
            as: polyline
            pts: [{ x: -12, y: 0 }, { x: 0, y: 0 }]
            angle: -12
            color: white
            join: round
            cap: round
            width: 3
          ik:
            angleRange: [-90, 90]
          children:
            - name: leftLowerArm
              pos: { x: -12, y: 0 }
              render:
                as: polyline
                pts: [{ x: -10, y: 0 }, { x: 0, y: 0 }]
                angle: -12
                color: white
                join: round
                cap: round
                width: 3
              ik:
                angleRange: [-90, -1]
              children:
                - pos: { x: -10, y: 0 }
                  children:
                    - name: leftHand
                      render: &hand
                        as: sprite
                        sprite: explorerHand
                        anchor: top
                        z: 2
                      constraint: [angle, body, 0, 0]
                  ik:
                    target: [leftHandTarget, 2]
        - name: rightUpperArm
          pos: { x: 6, y: -12 }
          render:
            as: polyline
            pts: [{ x: 0, y: 0 }, { x: 12, y: 0 }]
            angle: 12
            color: white
            join: round
            cap: round
            width: 3
          ik:
            angleRange: [-90, 90]
          children:
            - name: rightLowerArm
              pos: { x: 12, y: 0 }
              render:
                as: polyline
                pts: [{ x: 0, y: 0 }, { x: 10, y: 0 }]
                angle: 12
                color: white
                join: round
                cap: round
                width: 3
              ik:
                angleRange: [1, 90]
              children:
                - pos: { x: 10, y: 0 }
                  children:
                    - name: rightHand
                      render: *hand
                      constraint: [angle, body, 0, 0]
                  ik:
                    target: [rightHandTarget, 2]
  tentacles:
    - name: horn
      bone: head
      pos: { x: 13, y: -1 }
      n: 5
      lps: 3
      render: &tentacle
        color: xt252
        cap: round
        z: -1
      sizes: [2.7, 1, easeOutQuad]
      masses: [1, 1]
      eachConstraints:
        distance: [head, 13, -1]
    - name: tail
      bone: body
      pos: { x: 0, y: 12 }
      n: 8
      lps: 5
      render: *tentacle
      sizes: [4, 1, easeOutQuad]
      masses: [1, 1]
  anims:
    sprinting:
      loop: true
      channels:
        - target: [body, angle]
          keyframes:
            - [0, 10]
          alpha: 30
        - target: [leftHandTarget, pos]
          keyframes:
            - [0, { x: 0, y: -1.5 }]
          alpha: 30
          relative: true
        - target: [rightHandTarget, pos]
          keyframes:
            - [0, { x: 0, y: 1.5 }]
          alpha: 30
          relative: true
    idle:
      loop: true
      channels:
        - target: [body, pos]
          keyframes:
            - [1, { x: 0, y: 0 }, easeInOutSine]
            - [1, { x: 0, y: -1 }, easeInOutSine]
  kinematics:
    look:
      origin: head
      target: gazeTarget
    initial: standing
    states:
      walking:
        sprint: sprinting
        steps:
          len: 8
          height: 4
          time: 0.06
        allowedComponents: { x: 1, y: 0 }
        bones:
          - bone: leftFoot
            flip: [true, false, true]
          - bone: rightFoot
            flip: [true, false, false]
          - bone: leftFootTarget
            stepMode: step
            phaseOffset: 0
          - bone: rightFootTarget
            stepMode: step
            phaseOffset: 0.5
        transitions: &swt
          - [standing, [0b0111, [grounded], [moving]]] # 7 = !grounded || !moving
          # - [climbing, [0b1000, [moving], [colliding, climbable]]] # 8 = moving && onLadder
          - [walking, [moving]]
        jumpRule: &swJr [[grounded], standing]
      standing:
        anim: idle
        bones:
          - bone: leftFoot
            flip: [true, true, true]
          - bone: rightFoot
            flip: [false, false, false]
        allowedComponents: { x: 1, y: 0 }
        transitions: *swt
        jumpRule: *swJr
      # climbing:
      #   gravityScale: 0
      #   bones: # TODO
      #   transitions:
      #     - [standing, [0b01, [colliding, climbable]]] # 1 = !onLadder
      #   jumpRule: [[1], standing] # constant 1 = true
hooks:
  action1: [as, agent, setPlayer]
